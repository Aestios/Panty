var scr=document.getElementsByTagName('script');var zoombox_path=scr[scr.length-1].getAttribute("src").replace('zoombox.js','');(function($){var options={theme:'zoombox',opacity:0.8,duration:800,animation:true,width:600,height:400,gallery:true,autoplay:false,overflow:false}
var images=new Array();var elem;var isOpen=false;var link;var width;var height;var timer;var i=0;var content;var type='multimedia';var position=false;var imageset=false;var state='closed';var html='<div id="zoombox"> \
            <div class="mask"></div>\
            <div class="container">\
                <div class="content"></div>\
                <div class="title"></div>\
                <div class="next"></div>\
                <div class="prev"></div>\
                <div class="close"></div>\
                <div class="gallery"></div>\
            </div>\
        </div>';var filtreImg=/(\.jpg)|(\.jpeg)|(\.bmp)|(\.gif)|(\.png)/i;var filtreMP3=/(\.mp3)/i;var filtreFLV=/(\.flv)/i;var filtreSWF=/(\.swf)/i;var filtreQuicktime=/(\.mov)|(\.mp4)/i;var filtreWMV=/(\.wmv)|(\.avi)/i;var filtreDailymotion=/(http:\/\/www.dailymotion)|(http:\/\/dailymotion)/i;var filtreVimeo=/(http:\/\/www.vimeo)|(http:\/\/vimeo)/i;var filtreYoutube=/(youtube\.)/i;var filtreKoreus=/(http:\/\/www\.koreus)|(http:\/\/koreus)/i;$.zoombox=function(el,options){}
$.zoombox.options=options;$.zoombox.close=function(){close();}
$.zoombox.open=function(tmplink,opts){elem=null;link=tmplink;options=$.extend({},$.zoombox.options,opts);load();}
$.zoombox.html=function(cont,opts){content=cont;options=$.extend({},$.zoombox.options,opts);width=options.width;height=options.height;elem=null;open();}
$.fn.zoombox=function(opts){return this.each(function(){if($.browser.msie&&$.browser.version<7&&!window.XMLHttpRequest){return false;}
var obj=this;var galleryRegExp=/zgallery([0-9]+)/;var gallery=galleryRegExp.exec($(this).attr("class"));var tmpimageset=false;if(gallery!=null){if(!images[gallery[1]]){images[gallery[1]]=new Array();}
images[gallery[1]].push($(this));var pos=images[gallery[1]].length-1;tmpimageset=images[gallery[1]];}
$(this).unbind('click');$(this).click(function(){options=$.extend({},$.zoombox.options,opts);if(state!='closed')return false;elem=$(obj);link=elem.attr('href');imageset=tmpimageset;position=pos;load();return false;});});}
$.extend($.fx.step,{backgroundPosition:function(fx){if(fx.state===0&&typeof fx.end=='string'){var start=$.curCSS(fx.elem,'backgroundPosition');start=toArray(start);fx.start=[start[0],start[2]];var end=toArray(fx.end);fx.end=[end[0],end[2]];fx.unit=[end[1],end[3]];}
var nowPosX=[];nowPosX[0]=((fx.end[0]- fx.start[0])*fx.pos)+ fx.start[0]+ fx.unit[0];nowPosX[1]=((fx.end[1]- fx.start[1])*fx.pos)+ fx.start[1]+ fx.unit[1];fx.elem.style.backgroundPosition=nowPosX[0]+' '+nowPosX[1];function toArray(strg){strg=strg.replace(/left|top/g,'0px');strg=strg.replace(/right|bottom/g,'100%');strg=strg.replace(/([0-9\.]+)(\s|\)|$)/g,"$1px$2");var res=strg.match(/(-?[0-9\.]+)(px|\%|em|pt)\s(-?[0-9\.]+)(px|\%|em|pt)/);return[parseFloat(res[1],10),res[2],parseFloat(res[3],10),res[4]];}}});$(function(){$('#bg1ContentBody').css({backgroundPosition:'0px 0px'});$('#bg2ContentBody').css({backgroundPosition:'0px 0px'});$('#galleryContentBody').css({backgroundPosition:'0px 0px'});$('#galleryContentBody').animate({backgroundPosition:"(-10000px -2000px)"},30000,'linear');$('#bg1ContentBody').animate({backgroundPosition:"(-10000px -2000px)"},90000,'linear');$('#bg2ContentBody').animate({backgroundPosition:"(-10000px -2000px)"},300000,'linear');});function load(){if(state=='closed')isOpen=false;state='load';setDim();if(filtreImg.test(link)){img=new Image();img.src=link;$("body").append('<div id="zoombox_loader"></div>');$("#zoombox_loader").css("marginTop",scrollY());timer=window.setInterval(function(){loadImg(img);},100);}else{setContent();open();}}
function build(){$('body').append(html);$(window).keydown(function(event){shortcut(event.which);});$(window).resize(function(){resize();});$('#zoombox .mask').hide();$('#zoombox .gallery').hide();$('#zoombox').addClass(options.theme);$('#zoombox .close,#zoombox .mask,.zoombox_close').click(function(){close();return false;});$('#zoombox .mask').mouseover(function(){$('#zoombox .gallery').stop().fadeTo(500,0);});$('#zoombox .mask').mouseout(function(){$('#zoombox .gallery').stop().fadeTo(500,0.9);});if(imageset==false){$('#zoombox .next,#zoombox .prev').remove();}else{$('#zoombox .next').click(function(){next();});$('#zoombox .prev').click(function(){prev();});if(options.gallery){for(var i in imageset){var img=$('<img src="'+zoombox_path+'img/blank.png'+'" class="video gallery'+(i*1)+'"/>');if(filtreImg.test(imageset[i].attr('href'))){img=$('<img src="'+imageset[i].attr('href')+'" class="gallery'+(i*1)+'"/>');}
img.appendTo('#zoombox .gallery');img.click(function(){gotoSlide($(this).attr('class').replace('gallery',''));$('#zoombox .gallery img').removeClass('current');$(this).addClass('current');});if(i==position){img.addClass('current');}}}}}
function open(){if(isOpen==false){build();}else{$('#zoombox .title').empty();}
$('#zoombox .close').hide();$('#zoombox .container').removeClass('multimedia').removeClass('img');$('#zoombox .container').addClass(type);if(elem!=null&&elem.attr('title')){$('#zoombox .title').append(elem.attr('title'));}
$('#zoombox .content').empty();if(type=='img'&&isOpen==false&&options.animation==true){$('#zoombox .content').append(content);}
if(elem!=null&&elem.find('img').length!=0&&isOpen==false){var min=elem.find('img');$('#zoombox .container').css({width:min.width(),height:min.height(),top:min.offset().top,left:min.offset().left,opacity:0,marginTop:min.css('marginTop')});}else if(elem!=null&&isOpen==false){$('#zoombox .container').css({width:elem.width(),height:elem.height(),top:elem.offset().top,left:elem.offset().left});}else if(isOpen==false){$('#zoombox .container').css({width:100,height:100,top:windowH()/2-50,left:windowW()/2-50})}
var css={width:width,height:height,left:(windowW()- width)/2,top:(windowH()- height)/2,marginTop:scrollY(),opacity:1};if(options.animation==true){$('#zoombox .title').hide();$('#zoombox .container').animate(css,options.duration,function(){if(type=='multimedia'||isOpen==true){$('#zoombox .content').append(content);}
if(type=='image'||isOpen==true){$('#zoombox .content img').css('opacity',0).fadeTo(300,1);}
$('#zoombox .close').fadeIn();$('#zoombox .gallery').fadeIn();$('#zoombox .title').fadeIn(300);state='opened';isOpen=true;});$('#zoombox .mask').fadeTo(200,options.opacity);}else{$('#zoombox .content').append(content);$('#zoombox .close').show();$('#zoombox .gallery').show();$('#zoombox .container').css(css);$('#zoombox .mask').show();$('#zoombox .mask').css('opacity',options.opacity);isOpen=true;state='opened';}}
function close(){state='closing';window.clearInterval(timer);$(window).unbind('keydown');$(window).unbind('resize');if(type=='multimedia'){$('#zoombox .container').empty();}
var css={};if(elem!=null&&elem.find('img').length!=0){var min=elem.find('img');css={width:min.width(),height:min.height(),top:min.offset().top,left:min.offset().left,opacity:0,marginTop:min.css('marginTop')};}else if(elem!=null){css={width:elem.width(),height:elem.height(),top:elem.offset().top,left:elem.offset().left,opacity:0};}else{css={width:100,height:100,top:windowH()/2-50,left:windowW()/2-50,opacity:0};}
if(options.animation==true){$('#zoombox .mask').fadeOut(200);$('#zoombox .container').animate(css,options.duration,function(){$('#zoombox').remove();state='closed';isOpen=false;});}else{$('#zoombox').remove();state='closed';isOpen=false;}}
function setContent(){if(options.overflow==false){if(width*1+ 50>windowW()){height=(windowW()- 50)*height/width;width=windowW()- 50;}
if(height*1+ 50>windowH()){width=(windowH()-50)*width/height;height=windowH()- 50;}}
var url=link;type='multimedia';if(filtreImg.test(url)){type='img';content='<img src="'+link+'" width="'+width+'" height="'+height+'"/>';}else if(filtreMP3.test(url)){width=300;height=40;content='<object type="application/x-shockwave-flash" data="'+MP3Player+'?son='+url+'" width="'+width+'" height="'+height+'">';content+='<param name="movie" value="'+MP3Player+'?son='+url+'" /></object>';}else if(filtreFLV.test(url)){var autostart=0;if(options.autoplay==true){autostart=1;}
content='<object type="application/x-shockwave-flash" data="'+zoombox_path+'FLVPlayer.swf" width="'+width+'" height="'+height+'">\
<param name="allowFullScreen" value="true">\
<param name="scale" value="noscale">\
<param name="wmode" value="transparent">\
<param name="flashvars" value="flv='+url+'&autoplay='+autostart+'">\
<embed src="'+zoombox_path+'FLVPlayer.swf" width="'+width+'" height="'+height+'" allowscriptaccess="always" allowfullscreen="true" flashvars="flv='+url+'" wmode="transparent" />\
</object>';}else if(filtreSWF.test(url)){content='<object width="'+width+'" height="'+height+'"><param name="allowfullscreen" value="true" /><param name="allowscriptaccess" value="always" /><param name="movie" value="'+url+'" /><embed src="'+url+'" type="application/x-shockwave-flash" allowfullscreen="true" allowscriptaccess="always" width="'+width+'" height="'+height+'" wmode="transparent"></embed></object>';}else if(filtreQuicktime.test(url)){content='<embed src="'+url+'" width="'+width+'" height="'+height+'" controller="true" cache="true" autoplay="true"/>';}else if(filtreWMV.test(url)){content='<embed src="'+url+'" width="'+width+'" height="'+height+'" controller="true" cache="true" autoplay="true" wmode="transparent" />';}else if(filtreDailymotion.test(url)){var id=url.split('_');id=id[0].split('/');id=id[id.length-1];if(options.autoplay==true){id=id+'&autostart=1';}
content='<object width="'+width+'" height="'+height+'"><param name="movie" value="http://www.dailymotion.com/swf/'+id+'&colors=background:000000;glow:000000;foreground:FFFFFF;special:000000;&related=0"></param><param name="allowFullScreen" value="true"></param><param name="allowScriptAccess" value="always"></param><embed src="http://www.dailymotion.com/swf/'+id+'&colors=background:000000;glow:000000;foreground:FFFFFF;special:000000;&related=0" type="application/x-shockwave-flash" width="'+width+'" height="'+height+'" allowFullScreen="true" allowScriptAccess="always" wmode="transparent" ></embed></object>';}else if(filtreVimeo.test(url)){var id=url.split('/');id=id[3];if(options.autoplay==true){id=id+'&autoplay=1';}
content='<object width="'+width+'" height="'+height+'"><param name="allowfullscreen" value="true" />	<param name="allowscriptaccess" value="always" /><param name="wmode" value="transparent" /><param name="movie" value="http://www.vimeo.com/moogaloop.swf?clip_id='+id+'&amp;server=www.vimeo.com&amp;show_title=1&amp;show_byline=1&amp;show_portrait=1&amp;color=00AAEB&amp;fullscreen=1" />	<embed src="http://www.vimeo.com/moogaloop.swf?clip_id='+id+'&amp;server=www.vimeo.com&amp;show_title=1&amp;show_byline=1&amp;show_portrait=1&amp;color=00AAEB&amp;fullscreen=1" type="application/x-shockwave-flash" allowfullscreen="true" allowscriptaccess="always" width="'+width+'" height="'+height+'" wmode="transparent" ></embed></object>';}else if(filtreYoutube.test(url)){var id=url.split('watch?v=');id=id[1].split('&');id=id[0];if(options.autoplay==true){id=id+'&autoplay=1';}
content='<object width="'+width+'" height="'+height+'"><param name="movie" value="http://www.youtube.com/v/'+id+'&hl=fr&rel=0&color1=0xFFFFFF&color2=0xFFFFFF&hd=1"></param><embed src="http://www.youtube.com/v/'+id+'&hl=fr&rel=0&color1=0xFFFFFF&color2=0xFFFFFF&hd=1" type="application/x-shockwave-flash" width="'+width+'" height="'+height+'" wmode="transparent"></embed></object>';}else if(filtreKoreus.test(url)){url=url.split('.html');url=url[0];content='<object type="application/x-shockwave-flash" data="'+url+'" width="'+width+'" height="'+height+'"><param name="movie" value="'+url+'"><embed src="'+url+'" type="application/x-shockwave-flash" width="'+width+'" height="'+height+'"  wmode="transparent"></embed></object>';}else{content='<iframe src="'+url+'" width="'+width+'" height="'+height+'" border="0"></iframe>';}
return content;}
function loadImg(img){if(img.complete){i=0;window.clearInterval(timer);width=img.width;height=img.height;$('#zoombox_loader').remove();setContent();open();}
$('#zoombox_loader').css({'background-position':"0px "+i+"px"});i=i-40;if(i<(-440)){i=0;}}
function gotoSlide(i){if(state!='opened'){return false;}
position=i;elem=imageset[position];link=elem.attr('href');if($('#zoombox .gallery img').length>0){$('#zoombox .gallery img').removeClass('current');$('#zoombox .gallery img:eq('+i+')').addClass('current');}
load();return false;}
function next(){i=position+1;if(i>imageset.length-1){i=0;}
gotoSlide(i);}
function prev(){i=position-1;if(i<0){i=imageset.length-1;}
gotoSlide(i);}
function resize(){$('#zoombox .container').css({top:(windowH()- $('#zoombox .container').height())/2,left:(windowW()- $('#zoombox .container').width())/2});}
function shortcut(key){if(key==37){prev();}
if(key==39){next();}
if(key==27){close();}}
function setDim(){width=options.width;height=options.height;if(elem!=null){var widthReg=/w([0-9]+)/;var w=widthReg.exec(elem.attr("class"));if(w!=null){if(w[1]){width=w[1];}}
var heightReg=/h([0-9]+)/;var h=heightReg.exec(elem.attr("class"));if(h!=null){if(h[1]){height=h[1];}}}
return false;}
function windowH(){if(window.innerHeight)return window.innerHeight;else{return $(window).height();}}
function windowW(){if(window.innerWidth)return window.innerWidth;else{return $(window).width();}}
function scrollY(){scrOfY=0;if(typeof(window.pageYOffset)=='number'){scrOfY=window.pageYOffset;}else if(document.body&&(document.body.scrollTop)){scrOfY=document.body.scrollTop;}else if(document.documentElement&&(document.documentElement.scrollTop)){scrOfY=document.documentElement.scrollTop;}
return scrOfY;}
function scrollX(){scrOfX=0;if(typeof(window.pageXOffset)=='number'){scrOfX=window.pageXOffset;}else if(document.body&&(document.body.scrollLeft)){scrOfX=document.body.scrollLeft;}else if(document.documentElement&&(document.documentElement.scrollLeft)){scrOfX=document.documentElement.scrollLeft;}
return scrOfX;}
jQuery(function($){$('a.zoombox').zoombox({theme:'zoombox',opacity:0.8,duration:800,animation:true,width:600,height:400,gallery:true,autoplay:false});});})(jQuery);